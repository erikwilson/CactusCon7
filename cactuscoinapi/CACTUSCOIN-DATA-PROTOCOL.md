# Cactuscoin Data Protocol 
The Cactuscoin Data Protocol (CDP) is used to exchange binary messages between badges for proof of presence, registeration with the cactuscoinapi, and submission of coins to the API.

## Header 
Every CDP message must begin with headers contain two different fields, the version number (1 byte) and the message type (1 byte).  The current and only supported version as of writing is 1.

>
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |       Version Number          |         Message Type          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The different message types supported in protocol version 1 are described below:

| Type Number  | Name                             | Description                                                                |
| -------------|----------------------------------| ---------------------------------------------------------------------------|
| 1            | Registration Under BadgeID (RUB) | A message directed to the cactuscoin API to register a name with a badge   |
| 2            | Global Broadcast Payload (GBP)   | Periodically generated by badges to broadcast their presence to others     |
| 3            | Cactuscoin Signing Request (CSR) | A request made on behalf of a badge that sees a GBP to create a coin (CAD) |
| 4            | Coin Authentication Digest (CAD) | The respone made by a badge that receives a CSR, it is final stage in coin creation and is the proof of presence submitted to the cactuscoin api by both badges. |
| 5            | Automatic Tunneled Message (ATM) | A message that is tunneled through a cactuscoin node to the cactuscoin api |

## 1 - Registration Under BadgeID (RUB)
This message should be sent when a badge desires to have a name registered with it.  This message contains 4 fields, the badge ID, length of the name being submitted, the name as a UTF8 encoded string, and the RSA signature of the badge ID and name using the broadcasting badges private key.  Upon receiving a RUB the cactuscoin api should update the name stored with the associated badge id.  Badges may not begin to accumulate points until it has registered.

>
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |           Badge ID            |            Length             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                          Name (UTF8)                          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                          Name (UTF8)                          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                          Name (UTF8)                          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                     Signature (256 bytes)                     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


## 2 - Global Broadcast Payload (GBP)
This message should be periodically broadcasted by both badges and cactuscoin nodes (for location awards) over LoRa.  This message simply contains 2 fields, the badge ID and RSA signature of the badge ID using the broadcasting badges private key.  

>
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |           Badge ID            |      Signature (256 bytes)    |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                     Signature (256 bytes)                     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

## 3 - Cactuscoin Signing Request (CSR)
The CSR message is sent by a badge having seen another badge transmitting a GBP.  It is the first part of establishing a cactuscoin.  It contains 3 fields, the seer_id which is the badge id of the badge that saw the GBP, the beacon id which is the badge ID that was contained in the initial GBP, and the RSA signature of both badge IDs.

>
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |            Seer ID            |            Beacon ID          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                   Seer Signature (256 bytes)                  |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


## 4 - Cactuscoin Authentication Digest (CAD)
The CAD message is sent by a badge that has received a CSR from another badge.  It is the final part of establishing a cactuscoin through a proof of presence.  It contains 4 fields, the seer_id which is the badge id of the badge that saw the inital GBP, the beacon id which is the badge ID that was contained in the GBP, and the RSA signature of both badge IDs by the badge that sent the CSR (the seer), and the RSA signature of the first 3 fields by the badge that sent the original GBP.

>
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |            Seer ID            |            Beacon ID          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                   Seer Signature (256 bytes)                  |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                  Beacon Signature (256 bytes)                 |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


## 5 - Automatic Tunnel Message (ATM)
An ATM message is a transport message containing a message from a badge that was received over LoRa by a cactuscoin node.  It contains the 4 fields, the location ID of the node that received the message, the length, the RSA signature by the cactuscoin node of just the location and message length fields, and the encapsulated message being tunneled on behalf of the badge.

>
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |          Location ID          |         Message Length        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |             Cactuscoin Node Signature (256 bytes)             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                          Badge Message                        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
